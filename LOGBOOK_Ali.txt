# CURRENT TODOs AND STUFF CONCERNING 3DMOKE CODE ON FOURMIDABLE
================================================================

NOTE I always mark cleanup, todos, questions in the code with the easily searchable sequence "# TODO"
    (also Luka Skoric has left some open things with this mark)


=========================
OPEN TODOs:
- CLEANUP general
- Nanocube still has some things that are not working (realtive tickbox and calibrate stage experiment)
    and it seems that the code for the stage reacts a little bit to slow (slower than the stage moves)
    -> check this at a later moment
- quantalux add more gui controls (binning, show histogram, color image, autoadjsutrange)
- do not block thorlabs software while gui running (? maybe just run sdk when really needed)
- make gui  for "apply field steps" experiment



2024-04-23:
    - merged integrate-nanocube to master, use now master as production branch
    - added -135deg to HP calibration
    - I should check if the magents work as expected with all the calibrations now

2024-04-10:
    - realigned hexapole and redone hallprobe calibration
        old HPcalib matrix:
        [[-12.62722834179679, -15.555882861824347, -10.48532443798037], [-3.345805384352364, -4.429711419991506, -8.20835251552945], [9.569756107868283, 12.120959279298425, 5.001290606919113]]
        new HPcalib matrix:
		[[12.06081707068405, -16.43105190302377, 4.558304908217234], [-14.03369938998217, -4.681902746619606, 17.74730301953106], [12.228775790445898, 11.619109116303783, 11.43677500099918]]

2024-04-05:
    - started to integrate NanoCube
        NOTE it already has a calibration NanoCubeCalib, which seems to use a subinstrument pi_rotator
            which is also referenced in StageSampleRefCalib (seems to be connected to eucentric protocol ???)
            I will remove it in NanoCubeCalib and leave it in StageSampleRefCalib for the moment

2024-04-04:
    - rewired hexapole consistently, redone magent calibration
    - cleanup magnet calibration, moved data, results and plots to data/results_magnet_calibration

2024-04-02:
    - leaving the calibration for the senis as is (xyz -> -xzy)
      adding a -135deg rotation in calibration class to move to table FOR

2024-04-02:
    - start to change code for hallprobe calibration

2024-03-28:
    - not HallprobeC is wrong cabled, but current trough PoleC runs in wrong handedness
    - applied magnet calibration successfully (with switched kepco C output cable)
    - first tests with senis, confirmed FoR, verified wrong current handedness in poleC

2024-03-26:
    - HallsensorC gives switched polarity compared to other sensors
        other sensors give negative output voltage for positive current input to magnet (like in 3DMoke)
    - applied magnet calibration successfully

2024-03-25:
    - to get a positive kepco output for positive kepco input signal (like in 3DMoke), the input cables polarity has been switched temporairly
        -> for later: change polarity in NIcard output box and switch kepco input cables back

2024-03-21:
    - to generate the file for the MagnetHystCalib you have to run the following scripts and notebooks
        1) testing\collecting_degauss.py
            creates degauss_signal.h5 file
        2) experiments\calibration\magnetic_minor_loop.py
            creates hex_minor_Ichannel.h5 with fits of loops
        3) experiments\calibration\RL_circuit_testing.py for every pole
            (NOTE connect cable in paralell to kepco output to measure voltage as instrument "v_measurement" )
            creates rl_response_data_poleX.h5
            3.1) magnet_calibration_insteps\getting_rl_fft.ipynb
                creates rl_coeff.p from rl_response_data_poleX.h5
        4) now run magnet_calibration_insteps\inverse_hyst_fitting.ipynb to process and join the files from 1)-3)
            creates

2024-03-19:
    - found documentation of 3DMoke

2024-03-13:
    - Calibration: understanding how calibration of the hallprobes and magnets works, on what it relies, etc.
        -> look into experiments
    - Hallprobes: having clock Dev1/aiXX gives a ~2.5V offset (???)
    - Stage: replace smaract stage code with our stage
        NOTE before the smaract stagethe Fourmidable PI stage was used, so probably there is still some code around from it
    - laser button currently commented
    - "reference" instrument on AO seems to be needed for deGauss, find out what it is and does
    - incorporate quantalux gui

